extends ../common/layout

block layout-content
    //- Article management page: display all articles with edit/delete options
    .d-flex.justify-content-between.align-items-center.mb-4.flex-wrap.gap-3
        h1.mb-0 Article List
        //- Category filter form: submits when user selects a category
        .d-flex.align-items-center.gap-2
            form.d-flex.align-items-center.gap-2(action="/admin/article", method="GET") 
                label.form-label.mb-0(for="categoryFilter") Filter:
                //- Auto-submit when category changes (onChange triggers form submission)
                select.form-select.form-select-sm(id="categoryFilter", name="categoryId", onChange="this.form.submit()", style="min-width: 150px") 
                    //- Empty value shows all articles (selected when no filter active)
                    if !selectedCategoryId || selectedCategoryId === ''
                        option(value="", selected) All Categories
                    else
                        option(value="") All Categories
                    each cat in categories 
                        //- Mark this option as selected if it matches the filtered category
                        if selectedCategoryId && selectedCategoryId === cat._id.toString()
                            option(value=cat._id, selected)= cat.name
                        else
                            option(value=cat._id)= cat.name  
            //- Button to add new article
            a.btn.btn-success.btn-sm(href="/admin/article/add") 
                i.bi.bi-plus-circle.me-1
                | Add Article

    //- Table view for desktop/tablet
    .table-responsive.d-none.d-md-block
        table.table.table-striped.table-hover.align-middle
            //- Table headers
            thead.table-dark
                tr
                    th.text-start(style="width: 35%") Article
                    th.text-center(style="width: 45%") Text
                    th.text-center(style="width: 20%") Actions
            //- Table body: Loop through each article
            tbody
                each article in articles
                    tr
                        //- Article title and category (clickable title)
                        td
                            a.text-decoration-none.link-dark(href=`/admin/article/view?articleId=${article._id}`)
                                strong #{article.title}
                            br
                            small.text-muted Category: #{article.categoryId ? article.categoryId.name : 'Uncategorized'}
                        //- Article text preview
                        td.text-center
                            span.d-inline-block.text-truncate(style="max-width: 350px") #{article.text}
                        //- Edit and delete buttons
                        td.text-center
                            .d-inline-flex.gap-2
                                //- Edit button
                                form(action="/admin/article/edit", method="get")
                                    input(type="hidden", name="articleId", value=article._id)
                                    button.btn.btn-sm.btn-primary.m(type="submit") Edit
                                //- Delete button
                                form(action="/admin/article/delete", method="get")
                                    input(type="hidden", name="articleId", value=article._id)
                                    button.btn.btn-sm.btn-danger(type="submit") Delete

    //- Card view for mobile
    .d-block.d-md-none
        each article in articles
            .card.mb-3
                .card-body
                    //- Clickable article title
                    a.text-decoration-none.text-dark(href=`/admin/article/view?articleId=${article._id}`)
                        h5.card-title #{article.title}
                    p.mb-1
                        small.text-muted Category: #{article.categoryId ? article.categoryId.name : 'Uncategorized'}
                    p.card-text.text-muted #{article.text}
                    .d-flex.gap-2
                        form(action="/admin/article/edit", method="get")
                            input(type="hidden", name="articleId", value=article._id)
                            button.btn.btn-sm.btn-primary(type="submit") Edit
                        form(action="/admin/article/delete", method="get")
                            input(type="hidden", name="articleId", value=article._id)
                            button.btn.btn-sm.btn-danger(type="submit") Delete
