extends ../common/layout

block layout-content

    // Header row: Title + Add Button
    .d-flex.justify-content-between.align-items-center.mb-2
        h1.mb-0 Article List (total: #{totalArticles})
        a.btn.btn-success.btn-sm(href="/admin/article/add") Add Article

    // Small search bar directly under the title
    .input-group.input-group-sm.mb-4(style="max-width: 400px")
        input.form-control(
            type="text",
            name="search",
            placeholder="Search articles...",
            value=search || ""
        )
        .ms-2
            button.btn.btn-primary(type="submit") Search


    // Desktop Table
    .table-responsive.d-none.d-md-block
        table.table.table-hover.table-striped.align-middle
            thead.table-dark
                tr
                    th(style="width: 35%") Article
                    th.text-center(style="width: 45%") Preview
                    th.text-center(style="width: 20%") Actions
            tbody
                each article in articles
                    tr
                        td
                            a.text-decoration-none.link-dark(
                                href=`/admin/article/view?articleId=${article._id}`
                            )
                                strong #{article.title}
                            br
                            small.text-muted 
                                | Category: #{article.categoryId ? article.categoryId.name : 'Uncategorized'} 
                                |  â€¢ Created: #{article.createdAt ? new Date(article.createdAt).toLocaleDateString() : 'N/A'}

                        td.text-center
                            span.d-inline-block.text-truncate(style="max-width: 350px")
                                | #{article.text}

                        td.text-center
                            .d-inline-flex.gap-2
                                form(action="/admin/article/edit", method="get")
                                    input(type="hidden", name="articleId", value=article._id)
                                    button.btn.btn-sm.btn-primary(type="submit") Edit
                                form(action="/admin/article/delete", method="get")
                                    input(type="hidden", name="articleId", value=article._id)
                                    button.btn.btn-sm.btn-danger(type="submit") Delete

    // Mobile Cards
    .d-block.d-md-none
        each article in articles
            .card.mb-3.shadow-sm
                .card-body
                    a.text-decoration-none.text-dark(
                        href=`/admin/article/view?articleId=${article._id}`
                    )
                        h5.card-title.mb-1 #{article.title}

                    small.text-muted.d-block.mb-2
                        | Category: #{article.categoryId ? article.categoryId.name : 'Uncategorized'} 
                        |  â€¢ Created: #{article.createdAt ? new Date(article.createdAt).toLocaleDateString() : 'N/A'}

                    p.card-text.text-muted.text-truncate #{article.text}

                    .d-flex.gap-2.mt-2
                        form(action="/admin/article/edit", method="get")
                            input(type="hidden", name="articleId", value=article._id)
                            button.btn.btn-sm.btn-primary(type="submit") Edit
                        form(action="/admin/article/delete", method="get")
                            input(type="hidden", name="articleId", value=article._id)
                            button.btn.btn-sm.btn-danger(type="submit") Delete

    // Pagination
    if totalPages > 1
        nav.mt-4
            ul.pagination.justify-content-center

                // Previous
                li.page-item(class=(currentPage === 1 ? 'disabled' : ''))
                    a.page-link(
                        href=`?page=${currentPage - 1}&search=${search || ''}`
                    ) Previous

                // Page Numbers
                each num in [...Array(totalPages).keys()].map(n => n + 1)
                    li.page-item(class=(num === currentPage ? 'active' : ''))
                        a.page-link(
                            href=`?page=${num}&search=${search || ''}`
                        ) #{num}

                // Next
                li.page-item(class=(currentPage === totalPages ? 'disabled' : ''))
                    a.page-link(
                        href=`?page=${currentPage + 1}&search=${search || ''}`
                    ) Next
