extends ../common/layout

block layout-content
  .row.justify-content-center
    .col-lg-10
      .card.shadow-sm
        .card-body.p-4
          h1.h3.mb-4.text-center Add New Article

          form(action="/admin/article/add/submit", method="post", enctype="multipart/form-data", autocomplete="off")
            // Title
            .mb-3
              label.form-label(for="title") Title
              input.form-control(
                type="text",
                id="title",
                name="title",
                placeholder="Add hook title",
                autocomplete="off",
                required
              )

            // Article Text
            .mb-3
              label.form-label(for="article-text") Article Text
              textarea.form-control(
                id="article-text",
                name="text",
                rows="10",
                placeholder="Write your full article here...",
                style="min-height: 200px",
                autocomplete="off"
              )

            // Category
            .mb-3
              label.form-label(for="cat") Select Category
              select.form-select(id="cat", name="categoryId", required)
                option(value="") Select a category
                each cat in categories
                  option(value=cat._id)= cat.name

            // ðŸŒŸ NEW: IMAGE & CAPTION UPLOAD SECTION
            .mb-4
              label.form-label.fw-bold Article Images
              #image-container
                // The first image block (Required for the Hero image)
                .image-block.border.rounded.p-3.mb-3.bg-light
                  .row
                    .col-md-6.mb-2.mb-md-0
                      label.form-label.small Upload Image
                      input.form-control(
                        type="file",
                        name="images",
                        accept="image/*",
                        required
                      )
                    .col-md-6
                      label.form-label.small Image Caption (Source / Alt text)
                      input.form-control(
                        type="text",
                        name="alt",
                        placeholder="e.g., Photo by Reuters / TSMC Factory"
                      )
              
              // Button to dynamically add more image/caption blocks
              button#add-more-images.btn.btn-outline-secondary.btn-sm(type="button")
                | + Add Another Image

            // Buttons
            .d-flex.justify-content-end.gap-2.mt-4
              a.btn.btn-secondary(href="/admin/article") Cancel
              button.btn.btn-primary(type="submit") Add Article

  // ðŸŒŸ SCRIPT TO HANDLE ADDING MORE IMAGES
  script.
    document.addEventListener('DOMContentLoaded', function() {
      const addBtn = document.getElementById('add-more-images');
      const container = document.getElementById('image-container');

      addBtn.addEventListener('click', function() {
        // Find the first image block and clone it
        const originalBlock = container.querySelector('.image-block');
        const newBlock = originalBlock.cloneNode(true);

        // Clear the values in the cloned block so it's empty
        newBlock.querySelector('input[type="file"]').value = '';
        newBlock.querySelector('input[type="text"]').value = '';
        
        // Remove the 'required' attribute from extra images so they are optional
        newBlock.querySelector('input[type="file"]').removeAttribute('required');

        // Append the new block to the container
        container.appendChild(newBlock);
      });
    });